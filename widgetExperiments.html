<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
        <title>Untitled Document</title>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js">
        </script>
        <script type="text/javascript" src="http://code.angularjs.org/angular-0.9.13.min.js" ng:autobind>
        </script>
        <script type="text/javascript">
        	
            angular.widget('lz:hello', function(compileElement){
                var compiler = this; //?
                eachNode(compileElement, function(caseElement, index){
					var q=1;
					var lin=$(caseElement[0]);
					lin.attr('eventBusId','ebid');
					compiler.compile(lin);
                });
				
				return function(linkElement){
					alert("lz:hello: - linking")
				};
            });
			
			angular.widget('lz:link', function(compileElement){
                alert("link compilation");
				return function(linkElement){
					alert('lz:link: - linking')
				};
            });
            
			//code copied from angular.js
            function eachNode(element, fn){
                var i, chldNodes = element[0].childNodes || [], chld;
                for (i = 0; i < chldNodes.length; i++) {
                    if (!isTextNode(chld = chldNodes[i])) {
                        fn($(chld), i);
                    }
                }
            }
            
			//code copied from angular.js
            function isTextNode(node){
                return nodeName_(node) == '#text';
            }
            
        	//code copied from angular.js
			function nodeName_(element){
                    return element.nodeName ? element.nodeName : element[0].nodeName;
            };
            
        </script>
    </head>
    <body>
        Hello
        <div>
            <lz:hello>
                <lz:link>
                    link1
                </lz:link>
                <lz:link>
                    link2
                </lz:link>
            </lz:hello>
        </div>
        <div>
            <lz:hello>
                <lz:link>
                    link3
                </lz:link>
                <lz:link>
                    link4
                </lz:link>
            </lz:hello>
        </div>
    </body>
</html>
